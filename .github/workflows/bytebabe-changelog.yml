name: ByteBabe Changelog
on:
  push:
    branches:
      - main
    paths-ignore:
      - 'CHANGELOG.md'

permissions:
  contents: write
  pull-requests: write

jobs:
  update-changelog:
    name: ğŸ“ Update ByteBabe Changelog
    runs-on: ubuntu-latest
    
    steps:
      - name: ğŸ”„ Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸš€ Generate Changelog
        run: |
          # FunÃ§Ã£o para categorizar commits por mÃ³dulo
          get_module() {
            commit_msg="$1"
            case "$commit_msg" in
              *"docker"*|*"container"*) echo "ğŸ‹ Docker (Poseidon)" ;;
              *"git"*) echo "ğŸŒ¿ Git" ;;
              *"frontend"*|*"react"*|*"vue"*|*"angular"*) echo "ğŸ¨ Frontend" ;;
              *"backend"*|*"api"*|*"server"*) echo "âš™ï¸ Backend" ;;
              *"db"*|*"database"*) echo "ğŸ—ƒï¸ Database" ;;
              *"ide"*) echo "ğŸ’» IDE" ;;
              *"config"*|*"settings"*) echo "âš¡ Core" ;;
              *"cli"*|*"command"*) echo "ğŸ”§ CLI" ;;
              *"ui"*|*"interface"*) echo "âœ¨ UI" ;;
              *) echo "ğŸ”® General" ;;
            esac
          }

          # FunÃ§Ã£o para emoji do tipo de commit
          get_type_emoji() {
            case "$1" in
              feat*) echo "+" ;;
              fix*) echo "â—" ;;
              docs*) echo "â—†" ;;
              style*) echo "â—‹" ;;
              refactor*) echo "â—‡" ;;
              perf*) echo "â–³" ;;
              *) echo "â– " ;;
            esac
          }

          {
            echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
            echo "â•‘             BYTEBABE CHANGELOG               â•‘"
            echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
            echo
            echo "All notable changes to ByteBabe CLI will be documented in this cyberpunk-styled changelog."
            echo
            
            # VariÃ¡veis para controle
            current_date=""
            current_module=""
            
            # Processa os commits
            git log --pretty=format:'%ad | %s' --date=short | while read line; do
              date=$(echo "$line" | cut -d'|' -f1)
              msg=$(echo "$line" | cut -d'|' -f2-)
              type=$(echo "$msg" | grep -oP '^\s*\K(feat|fix|docs|style|refactor|perf|test|build|ci|chore)(?=:)' || echo "other")
              module=$(get_module "$msg")
              type_emoji=$(get_type_emoji "$type")
              
              # Nova data
              if [[ "$current_date" != "$date" ]]; then
                echo
                echo "â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”"
                echo "â”‚ $date"
                echo "â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜"
                current_date="$date"
                current_module=""
              fi
              
              # Novo mÃ³dulo
              if [[ "$current_module" != "$module" ]]; then
                echo
                echo "$module"
                current_module="$module"
              fi
              
              # Formata a mensagem do commit
              echo "$type_emoji ${msg#*: }"
            done
          } > CHANGELOG.md

      - name: ğŸ” Check for Changes
        id: check_changes
        run: |
          git diff --quiet CHANGELOG.md || echo "changes=true" >> $GITHUB_OUTPUT

      - name: ğŸ¤– Create Pull Request
        if: steps.check_changes.outputs.changes == 'true'
        uses: peter-evans/create-pull-request@v5
        with:
          commit-message: "docs: Update ByteBabe Changelog"
          title: "âš¡ ByteBabe Changelog Update"
          body: |
            ```
            â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
            â•‘        AUTOMATED CHANGELOG UPDATE            â•‘
            â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
            ```
            
            This PR was automatically generated to update the ByteBabe CLI changelog.
            
            Changes are categorized by module and include:
            - Docker (Poseidon) ğŸ‹
            - Git Operations ğŸŒ¿
            - Frontend Tools ğŸ¨
            - Backend Services âš™ï¸
            - Database Management ğŸ—ƒï¸
            - IDE Integration ğŸ’»
            - Core Features âš¡
            - CLI Updates ğŸ”§
            - UI Enhancements âœ¨
          branch: update-bytebabe-changelog
          base: main
          labels: |
            documentation
            automated
            cyberpunk
          delete-branch: true